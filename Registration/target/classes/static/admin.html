<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - University Management</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        header {
            background-color: var(--dark-color);
            color: white;
            padding: 1rem 2rem;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        h1, h2 {
            margin-bottom: 1rem;
            color: var(--dark-color);
        }

        .section {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: var(--light-color);
            font-weight: 600;
        }

        tr:hover {
            background-color: rgba(0,0,0,0.02);
        }

        .btn {
            padding: 0.5rem 0.8rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e67e22;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            width: 80%;
            max-width: 700px;
            border-radius: 8px;
            overflow: hidden;
            animation: modalopen 0.5s;
        }

        @keyframes modalopen {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            padding: 1rem 1.5rem;
            background-color: var(--dark-color);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-btn {
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            background-color: #f5f5f5;
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        .course-form, .lecture-form {
            display: grid;
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.7rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .success-message {
            display: none;
            background-color: var(--success-color);
            color: white;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            text-align: center;
        }

        .alert {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: none;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                margin: 2% auto;
            }

            .action-buttons {
                flex-direction: column;
                gap: 0.3rem;
            }

            .action-buttons .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
<header>
    <h1>Admin - University Management</h1>
</header>

<div class="container">
    <!-- Course Management Section -->
    <div class="section">
        <h2>Course Management</h2>
        <p>Create new courses for the University Course Registration system.</p>
        <button class="btn btn-primary" id="createCourseBtn">Create New Course</button>
    </div>

    <!-- Lecture Management Section -->
    <div class="section">
        <h2>Lecture Management</h2>
        <p>Manage lectures with create, read, update, and delete operations.</p>

        <div class="alert alert-success" id="lectureSuccessAlert">
            Operation completed successfully!
        </div>
        <div class="alert alert-danger" id="lectureErrorAlert">
            An error occurred. Please try again.
        </div>

        <button class="btn btn-primary" id="addLectureBtn">Add New Lecture</button>

        <table id="managementTable">
            <thead>
            <tr>
                <th>ID</th>
                <th>Course</th>
                <th>Lecturer</th>
                <th>Day</th>
                <th>Time</th>
                <th>Location</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <!-- Lecture data will be inserted here by JavaScript -->
            </tbody>
        </table>
    </div>
</div>

<!-- Create Course Modal -->
<div id="createCourseModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Create New Course</h2>
            <span class="close-btn">×</span>
        </div>
        <div class="modal-body">
            <div class="success-message" id="createSuccessMessage">
                Course created successfully!
            </div>
            <form id="createCourseForm" class="course-form">
                <div class="form-group">
                    <label for="createTitle">Title</label>
                    <input type="text" id="createTitle" required>
                </div>
                <div class="form-group">
                    <label for="createInstructor">Instructor</label>
                    <input type="text" id="createInstructor" required>
                </div>
                <div class="form-group">
                    <label for="createPrice">Price</label>
                    <input type="number" id="createPrice" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="createDuration">Duration (weeks)</label>
                    <input type="number" id="createDuration" required>
                </div>
                <div class="form-group">
                    <label for="createDescription">Description</label>
                    <textarea id="createDescription" required></textarea>
                </div>
                <div class="form-group">
                    <label for="createLearningPoints">Learning Points (one per line)</label>
                    <textarea id="createLearningPoints" required></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" id="cancelCreateCourse">Cancel</button>
            <button class="btn btn-primary" id="confirmCreateCourse">Create Course</button>
        </div>
    </div>
</div>

<!-- Add/Edit Lecture Modal -->
<div id="lectureModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="lectureModalTitle">Add New Lecture</h2>
            <span class="close-btn">×</span>
        </div>
        <div class="modal-body">
            <form id="lectureForm" class="lecture-form">
                <input type="hidden" id="lectureId">
                <div class="form-group">
                    <label for="courseName">Course Name</label>
                    <select id="courseName" required>
                        <option value="">Select Course</option>
                        <!-- Courses will be populated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="lecturerName">Lecturer</label>
                    <input type="text" id="lecturerName" required>
                </div>
                <div class="form-group">
                    <label for="lectureDay">Day</label>
                    <select id="lectureDay" required>
                        <option value="">Select Day</option>
                        <option value="Monday">Monday</option>
                        <option value="Tuesday">Tuesday</option>
                        <option value="Wednesday">Wednesday</option>
                        <option value="Thursday">Thursday</option>
                        <option value="Friday">Friday</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="lectureTime">Time</label>
                    <input type="time" id="lectureTime" required>
                </div>
                <div class="form-group">
                    <label for="lectureDuration">Duration (minutes)</label>
                    <input type="number" id="lectureDuration" min="30" max="240" value="60" required>
                </div>
                <div class="form-group">
                    <label for="lectureLocation">Location</label>
                    <input type="text" id="lectureLocation" placeholder="e.g., Building A, Room 101" required>
                </div>
                <div class="form-group">
                    <label for="lectureDescription">Description (Optional)</label>
                    <textarea id="lectureDescription" placeholder="Additional notes about the lecture"></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" id="cancelLecture">Cancel</button>
            <button class="btn btn-primary" id="saveLecture">Save Lecture</button>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h2>Confirm Action</h2>
            <span class="close-btn">×</span>
        </div>
        <div class="modal-body">
            <p id="confirmMessage">Are you sure you want to delete this lecture?</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" id="cancelConfirm">Cancel</button>
            <button class="btn btn-danger" id="confirmAction">Delete</button>
        </div>
    </div>
</div>

<script>
    // DOM Elements for Course Management
    const createCourseModal = document.getElementById('createCourseModal');
    const createCourseBtn = document.getElementById('createCourseBtn');
    const cancelCreateCourse = document.getElementById('cancelCreateCourse');
    const confirmCreateCourse = document.getElementById('confirmCreateCourse');
    const createCourseForm = document.getElementById('createCourseForm');
    const createSuccessMessage = document.getElementById('createSuccessMessage');

    // DOM Elements for Lecture Management
    const managementTable = document.getElementById('managementTable').querySelector('tbody');
    const addLectureBtn = document.getElementById('addLectureBtn');
    const lectureModal = document.getElementById('lectureModal');
    const confirmModal = document.getElementById('confirmModal');
    const closeBtns = document.querySelectorAll('.close-btn');
    const cancelLecture = document.getElementById('cancelLecture');
    const saveLecture = document.getElementById('saveLecture');
    const cancelConfirm = document.getElementById('cancelConfirm');
    const confirmAction = document.getElementById('confirmAction');
    const lectureForm = document.getElementById('lectureForm');
    const lectureSuccessAlert = document.getElementById('lectureSuccessAlert');
    const lectureErrorAlert = document.getElementById('lectureErrorAlert');
    const lectureModalTitle = document.getElementById('lectureModalTitle');

    // Variables for current action
    let currentAction = '';
    let currentLectureId = null;

    // Fetch and populate courses in lecture form
    async function loadCoursesForForm() {
        try {
            const response = await fetch('http://localhost:9091/api/courses');
            if (!response.ok) throw new Error('Failed to fetch courses');
            const courses = await response.json();
            const courseSelect = document.getElementById('courseName');
            courseSelect.innerHTML = '<option value="">Select Course</option>';
            courses.forEach(course => {
                const option = document.createElement('option');
                option.value = course.title;
                option.textContent = course.title;
                courseSelect.appendChild(option);
            });
        } catch (error) {
            console.error('Error fetching courses:', error);
            lectureErrorAlert.textContent = 'Failed to load courses. Please try again.';
            lectureErrorAlert.style.display = 'block';
            setTimeout(() => lectureErrorAlert.style.display = 'none', 3000);
        }
    }

    // Course Management Event Listeners
    createCourseBtn.addEventListener('click', () => {
        createCourseForm.reset();
        createSuccessMessage.style.display = 'none';
        createCourseModal.style.display = 'block';
    });

    cancelCreateCourse.addEventListener('click', () => {
        createCourseModal.style.display = 'none';
    });

    confirmCreateCourse.addEventListener('click', async () => {
        if (createCourseForm.checkValidity()) {
            try {
                const courseData = {
                    title: document.getElementById('createTitle').value,
                    instructor: document.getElementById('createInstructor').value,
                    price: parseFloat(document.getElementById('createPrice').value),
                    duration: parseInt(document.getElementById('createDuration').value),
                    description: document.getElementById('createDescription').value,
                    learningPoints: document.getElementById('createLearningPoints').value.split('\n').filter(point => point.trim())
                };

                const response = await fetch('http://localhost:9091/api/courses', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(courseData)
                });

                if (!response.ok) throw new Error('Failed to create course');

                createSuccessMessage.style.display = 'block';
                createCourseForm.reset();

                // Hide success message and modal after 3 seconds
                setTimeout(() => {
                    createSuccessMessage.style.display = 'none';
                    createCourseModal.style.display = 'none';
                }, 3000);
            } catch (error) {
                console.error('Error creating course:', error);
                createSuccessMessage.style.display = 'block';
                createSuccessMessage.style.backgroundColor = 'var(--accent-color)';
                createSuccessMessage.textContent = 'Failed to create course. Please try again.';
                setTimeout(() => {
                    createSuccessMessage.style.display = 'none';
                    createSuccessMessage.style.backgroundColor = 'var(--success-color)';
                    createSuccessMessage.textContent = 'Course created successfully!';
                }, 3000);
            }
        } else {
            createCourseForm.reportValidity();
        }
    });

    // Lecture Management Functions
    async function loadLectures() {
        try {
            const response = await fetch('http://localhost:9091/api/lectures');
            if (!response.ok) throw new Error('Failed to fetch lectures');
            const lectures = await response.json();
            renderManagementTable(lectures);
        } catch (error) {
            console.error('Error fetching lectures:', error);
            managementTable.innerHTML = '<tr><td colspan="7" style="text-align: center;">Failed to load lectures. Please try again.</td></tr>';
        }
    }

    function renderManagementTable(lectures) {
        managementTable.innerHTML = '';

        if (lectures.length === 0) {
            const row = document.createElement('tr');
            row.innerHTML = `<td colspan="7" style="text-align: center;">No lectures to manage</td>`;
            managementTable.appendChild(row);
            return;
        }

        lectures.forEach(lecture => {
            const row = document.createElement('tr');

            row.innerHTML = `
                    <td>${lecture.id}</td>
                    <td>${lecture.course}</td>
                    <td>${lecture.lecturer}</td>
                    <td>${lecture.day}</td>
                    <td>${lecture.time}</td>
                    <td>${lecture.location}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-warning edit-btn" data-id="${lecture.id}">Edit</button>
                            <button class="btn btn-danger delete-btn" data-id="${lecture.id}">Delete</button>
                        </div>
                    </td>
                `;

            managementTable.appendChild(row);
        });

        // Add event listeners to edit and delete buttons
        document.querySelectorAll('.edit-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const id = parseInt(e.target.getAttribute('data-id'));
                editLecture(id);
            });
        });

        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const id = parseInt(e.target.getAttribute('data-id'));
                confirmDelete(id);
            });
        });
    }

    function addNewLecture() {
        currentAction = 'add';
        lectureForm.reset();
        document.getElementById('lectureId').value = '';
        lectureModalTitle.textContent = 'Add New Lecture';
        lectureModal.style.display = 'block';
    }

    async function editLecture(id) {
        try {
            const response = await fetch(`http://localhost:9091/api/lectures/${id}`);
            if (!response.ok) throw new Error('Failed to fetch lecture');
            const lecture = await response.json();

            currentAction = 'edit';
            currentLectureId = id;

            document.getElementById('lectureId').value = lecture.id;
            document.getElementById('courseName').value = lecture.course;
            document.getElementById('lecturerName').value = lecture.lecturer;
            document.getElementById('lectureDay').value = lecture.day;
            document.getElementById('lectureTime').value = lecture.time;
            document.getElementById('lectureDuration').value = lecture.duration;
            document.getElementById('lectureLocation').value = lecture.location;
            document.getElementById('lectureDescription').value = lecture.description || '';

            lectureModalTitle.textContent = 'Edit Lecture';
            lectureModal.style.display = 'block';
        } catch (error) {
            console.error('Error fetching lecture:', error);
            showLectureAlert('error', 'Failed to load lecture. Please try again.');
        }
    }

    function confirmDelete(id) {
        currentLectureId = id;
        confirmModal.style.display = 'block';
    }

    async function saveLectureHandler() {
        if (!lectureForm.checkValidity()) {
            lectureForm.reportValidity();
            return;
        }

        const lectureData = {
            id: currentAction === 'edit' ? currentLectureId : 0,
            course: document.getElementById('courseName').value,
            lecturer: document.getElementById('lecturerName').value,
            day: document.getElementById('lectureDay').value,
            time: document.getElementById('lectureTime').value,
            duration: parseInt(document.getElementById('lectureDuration').value),
            location: document.getElementById('lectureLocation').value,
            description: document.getElementById('lectureDescription').value
        };

        try {
            const method = currentAction === 'add' ? 'POST' : 'PUT';
            const url = currentAction === 'add' ? 'http://localhost:9091/api/lectures' : `http://localhost:9091/api/lectures/${currentLectureId}`;

            const response = await fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(lectureData)
            });

            if (!response.ok) throw new Error(`Failed to ${currentAction === 'add' ? 'create' : 'update'} lecture`);

            showLectureAlert('success', `Lecture ${currentAction === 'add' ? 'added' : 'updated'} successfully!`);
            lectureModal.style.display = 'none';
            loadLectures();
        } catch (error) {
            console.error(`Error ${currentAction === 'add' ? 'creating' : 'updating'} lecture:`, error);
            showLectureAlert('error', `Failed to ${currentAction === 'add' ? 'create' : 'update'} lecture. Please try again.`);
        }
    }

    async function deleteLecture() {
        try {
            const response = await fetch(`http://localhost:9091/api/lectures/${currentLectureId}`, {
                method: 'DELETE'
            });

            if (!response.ok) throw new Error('Failed to delete lecture');

            showLectureAlert('success', 'Lecture deleted successfully!');
            confirmModal.style.display = 'none';
            loadLectures();
        } catch (error) {
            console.error('Error deleting lecture:', error);
            showLectureAlert('error', 'Failed to delete lecture. Please try again.');
        }
    }

    function showLectureAlert(type, message) {
        const alert = type === 'success' ? lectureSuccessAlert : lectureErrorAlert;
        alert.textContent = message;
        alert.style.display = 'block';

        setTimeout(() => {
            alert.style.display = 'none';
        }, 3000);
    }

    // General Event Listeners
    closeBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            createCourseModal.style.display = 'none';
            lectureModal.style.display = 'none';
            confirmModal.style.display = 'none';
        });
    });

    window.addEventListener('click', (e) => {
        if (e.target === createCourseModal) {
            createCourseModal.style.display = 'none';
        }
        if (e.target === lectureModal) {
            lectureModal.style.display = 'none';
        }
        if (e.target === confirmModal) {
            confirmModal.style.display = 'none';
        }
    });

    // Lecture Management Event Listeners
    addLectureBtn.addEventListener('click', addNewLecture);
    cancelLecture.addEventListener('click', () => {
        lectureModal.style.display = 'none';
    });
    saveLecture.addEventListener('click', saveLectureHandler);
    cancelConfirm.addEventListener('click', () => {
        confirmModal.style.display = 'none';
    });
    confirmAction.addEventListener('click', deleteLecture);

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
        loadLectures();
        loadCoursesForForm();
    });
</script>
</body>
</html>